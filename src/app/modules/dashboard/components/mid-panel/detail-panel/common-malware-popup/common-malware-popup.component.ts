import {
  ChangeDetectorRef,
  Component,
  EventEmitter,
  Input,
  Output,
  SimpleChanges,
} from '@angular/core';
import { CommonModule } from '@angular/common';
import { SupabaseService } from 'src/app/modules/dashboard/services/supabase.service';
import { TabModule } from '@syncfusion/ej2-angular-navigations';
import { TableDetailCoChuDichComponent } from "./table-detail-co-chu-dich/table-detail-1.component";
import { TableDetailThongThuongComponent } from "./table-detail-thong-thuong/table-detail-1.component";
import { Constant } from 'src/app/core/config/constant';

@Component({
  selector: 'app-common-malware-popup',
  standalone: true,
  imports: [CommonModule, TabModule, TableDetailCoChuDichComponent, TableDetailThongThuongComponent],
  templateUrl: './common-malware-popup.component.html',
  styleUrls: ['./common-malware-popup.component.scss'],
})
export class CommonMalwarePopupComponent {
  @Input() mainType: string = '';
  @Input() subType: string = '';
  @Input() startDate: string = "";
  @Input() endDate:string = "";
  @Input() isClickTrongNgay:boolean = false;
  @Input() is_common_malware:boolean = false;

  isPopupVisible: boolean = false;
  @Output() togglePopupEvent = new EventEmitter<boolean>();
  tableData: any;

  togglePopup(isPopupVisible: boolean) {
    this.togglePopupEvent.emit(isPopupVisible);
  }
  constructor(
    private supabase: SupabaseService,
    private cdr: ChangeDetectorRef,
  ) {}

  async ngOnChanges(changes: SimpleChanges) {
    if(changes?.subType?.currentValue){
      if(this.subType == Constant.SUB_TYPE_DEVICE.ALL){
        if(this.mainType == Constant.MAIN_TYPE.QS){
          this.subType = Constant.SUB_TYPE_DEVICE.QS_QP;
        }else if(this.mainType == Constant.MAIN_TYPE.CD){
          this.subType = Constant.SUB_TYPE_DEVICE.TRONG_YEU_QUOC_GIA;
        }
      }
    }else if(changes?.mainType?.currentValue == '' || changes?.mainType?.currentValue){
      if(this.mainType == Constant.MAIN_TYPE.QS){
        this.subType = Constant.SUB_TYPE_DEVICE.QS_QP;
      }else if(this.mainType == Constant.MAIN_TYPE.CD){
        this.subType = Constant.SUB_TYPE_DEVICE.TRONG_YEU_QUOC_GIA;
      }else{
        this.subType = Constant.SUB_TYPE_DEVICE.ALL;
      }
    }
  }
}
