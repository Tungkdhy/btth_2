<div class="table-detail-panel-card malware">
  <div class="d-flex helptool">
    <input
      class="detailSearch"
      type="text"
      id="searchInput"
      [(ngModel)]="searchText"
      placeholder="Tìm kiếm theo từ khóa"
    />
    <div class="d-flex select-box-center">
      Nguồn:
      <select class="form-select-box-1" [(ngModel)]="alertSource">
        <option selected value="">Tất cả</option>
        <option *ngIf="mainType == '' || mainType == 'QS'" value="FMS">
          FMS
        </option>
        <option
          *ngIf="mainType == '' || mainType == 'QS' || mainType == 'INT'"
          value="TA-21"
        >
          TA21
        </option>
        <option *ngIf="mainType == '' || mainType == 'QS'" value="FIDELIS">
          FIDELIS
        </option>
        <option *ngIf="mainType == '' || mainType == 'QS'" value="IBM Qradar">
          IBM Qradar
        </option>
        <option *ngIf="mainType == '' || mainType == 'CD'" value="MMS">
          MMS
        </option>
        <option *ngIf="mainType == '' || mainType == 'CD'" value="NextAV">
          NextAV
        </option>
        <option *ngIf="mainType == '' || mainType == 'INT'" value="SOCI">
          SOC-i
        </option>
        <option *ngIf="mainType == '' || mainType == 'INT'" value="VCM">
          VCM
        </option>
      </select>
    </div>
    <div class="d-flex select-box-center">
      Loại cảnh báo:
      <select class="form-select-box-1" [(ngModel)]="columnType">
        <option selected value="">Tất cả</option>
        <option value="MALWARE">Mã độc</option>
        <option value="BLACK_DOMAIN">Tên miền</option>
        <option value="INTERNET">Internet</option>
        <option value="HUNTING">Bất thường</option>
      </select>
    </div>
    <div class="d-flex select-box-center">
      Trạng thái xử lý:
      <select class="form-select-box-1" [(ngModel)]="xuLyType">
        <option selected value="">Tất cả</option>
        <option value="Đã xử lý">Đã xử lý</option>
        <option value="Chưa xử lý">Chưa xử lý</option>
        <option value="Đang xử lý">Đang xử lý</option>
      </select>
    </div>

    <button class="detailsearchButton" (click)="search()">Tìm kiếm</button>
    <button class="detailsearchButton" (click)="exportExcel()">
      Xuất excel
    </button>
  </div>
  <div class="table-detail-haft">
    <table class="">
      <thead>
        <tr>
          <th>STT</th>
          <th>Đơn vị</th>
          <th>Cảnh báo</th>
          <th>IP<br/>MAC</th>
          <th>Quản lý</th>
          <th>Thời gian</th>
          <th>Chi tiết<br/> cảnh báo</th>
          <th>Nguồn</th>
          <th>
            <div>Loại mạng</div>
            <div>Quản lý</div>
          </th>
          <th>Kết quả xử lý</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="dataSource?.length === 0">
          <td colspan="10" class="text-center">Không có dữ liệu</td>
        </tr>
        <tr *ngFor="let item of dataSource; let index = index">
          <td>{{ (page - 1) * pageSize + index + 1 }}</td>
          <td>
            {{ getUnitName(item?.unit_path) || "" }}
            <div>

                {{ getUnitNameParent(item?.unit_path) || "" }}

            </div>
          </td>
          <td>
            {{ getValueAlertType(item?.alert_type) }}
          </td>
          <td (click)="openInfoDeviceModal(item?.source_mac)">
            {{ item.source_ip }}
            <div>
              {{ item?.source_mac }}
            </div>
          </td>
          <td>
            {{ item?.employee_name }}
          </td>
          <td>
            <div>
              {{ item?.last_active | date: "dd-MM-yyyy" }}
            </div>
            <div>
              {{ item?.last_active | date: "HH:mm:ss" }}
            </div>
          </td>
          <td>
            {{ item?.message }}
          </td>
          <td>
            {{ item?.alert_source }}
          </td>
          <td>
            {{ getTypeNetwork(item?.main_type) }}
            <div>
              {{ getRegionType(item?.loploi) }}
            </div>
          </td>
          <!-- <td
            (click)="openProcessDetailModal(item?.source_mac, item?.alert_type)"
          >
            {{ item?.khacfuc?.status || "Chưa xử lý" }}
            <div>
              {{ item?.khacfuc?.note }}
            </div>
          </td> -->
          <td>
            <div *ngIf="item?.khacfuc?.status == 'Đã xử lý'">
              <div>
                <b>Phát hiện:</b> {{ item?.khacfuc?.date_detect | date: "dd-MM-yyyy HH:mm:ss" }}
              </div>
              <div>
                <b>Khắc phục:</b> {{ item?.khacfuc?.date | date: "dd-MM-yyyy HH:mm:ss" }}
              </div>
            </div>
            <div>
              <b>Trạng thái:</b> {{ item?.khacfuc?.status || "Chưa xử lý" }}
            </div>
            <div *ngIf="item?.khacfuc?.status == 'Đã xử lý' || item?.khacfuc?.status == 'Đang xử lý'">
              <b>Nội dung:</b> {{ item?.khacfuc?.note }}
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="d-flex justify-content-between">
    <div class="total">
      <div>
        Tổng số: <span>{{ total | numberFormat }}</span>
      </div>
    </div>
    <div>
      <ngb-pagination
        [collectionSize]="total"
        [maxSize]="5"
        [(page)]="page"
        [pageSize]="pageSize"
        (pageChange)="onPageChange($event)"
      >
      </ngb-pagination>
    </div>
  </div>
</div>
